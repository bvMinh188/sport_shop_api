<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên Mật Khẩu</title>
    <link rel="stylesheet" href="/css/auth.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="form-header">
            <img src="https://t4.ftcdn.net/jpg/09/82/07/11/360_F_982071173_oTETgokPvxjDQysPY3QEppuA0TYoYjk6.jpg" 
                 alt="Reset Password">
            <h2>Phục hồi mật khẩu</h2>
        </div>

        <div id="message" class="alert"></div>

        <form id="forgotPasswordForm">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" 
                       class="form-control" 
                       id="email" 
                       name="email" 
                       placeholder="Nhập email của bạn"
                       required>
            </div>
            <button type="submit" class="btn-primary">Gửi yêu cầu</button>
            <button type="button" class="btn-secondary" onclick="window.location.href='/auth/login'">Quay lại đăng nhập</button>
        </form>
    </div>

    <!-- Add jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        $(document).ready(function() {
            function showMessage(message, type) {
                const messageDiv = $("#message");
                messageDiv.removeClass("alert-danger alert-success")
                    .addClass(type === "error" ? "alert-danger" : "alert-success")
                    .text(message)
                    .show();
                
                setTimeout(() => {
                    messageDiv.fadeOut();
                }, 3000);
            }

            $('#forgotPasswordForm').submit(function(e) {
                e.preventDefault();
                const email = $('#email').val();
                const submitBtn = $(this).find('button[type="submit"]');
                const originalText = submitBtn.text();

                submitBtn.prop('disabled', true)
                    .text('Đang xử lý...');

                $.ajax({
                    url: '/auth/forgot-password',
                    method: 'POST',
                    data: { email },
                    success: function(response) {
                        if (response.success) {
                            showMessage('Link đặt lại mật khẩu đã được gửi vào email của bạn', 'success');
                            setTimeout(() => {
                                window.location.href = '/auth/login';
                            }, 3000);
                        } else {
                            showMessage(response.message || 'Có lỗi xảy ra', 'error');
                            submitBtn.prop('disabled', false).text(originalText);
                        }
                    },
                    error: function(xhr) {
                        showMessage(xhr.responseJSON?.message || 'Có lỗi xảy ra', 'error');
                        submitBtn.prop('disabled', false).text(originalText);
                    }
                });
            });
        });
    </script>
</body> 